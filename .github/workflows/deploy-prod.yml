# name: Deploy Prod

# on:
#   release:
#     types: [published]

# jobs:
#   deploy:
#     name: Deploy to Prod
#     runs-on: ubuntu-latest
#     permissions:
#       id-token: write
#       contents: read

#     defaults:
#       run:
#         working-directory: ./terraform

#     steps:
#     - name: Checkout Code
#       uses: actions/checkout@v4

#     - name: Setup Node.js
#       uses: actions/setup-node@v4
#       with:
#         node-version: 20
#         cache: 'pnpm'

#     - name: Install pnpm
#       uses: pnpm/action-setup@v2
#       with:
#         version: 9

#     - name: Install Dependencies
#       run: pnpm install --frozen-lockfile
#       working-directory: .

#     - name: Build Application
#       run: pnpm run build
#       working-directory: .

#     - name: Setup Terraform
#       uses: hashicorp/setup-terraform@v3

#     - name: Terraform Init
#       run: terraform init
#       env:
#         AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
#         AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
#         AWS_REGION: ap-south-1

#     - name: Terraform Workspace
#       run: terraform workspace select prod || terraform workspace new prod

#     - name: Terraform Apply
#       run: terraform apply -auto-approve
#       env:
#         AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
#         AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
#         AWS_REGION: ap-south-1
#         TF_VAR_database_url: ${{ secrets.DATABASE_URL }}
#         TF_VAR_environment: prod
#         TF_VAR_project: iconcoderz
#         # Add other vars from secrets
